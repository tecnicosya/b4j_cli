<!DOCTYPE html>
<!-- Web Index/List View for {{ModelName}} -->
<!--
TEMPLATE PLACEHOLDERS:
 {{ModelName}} - The model name in PascalCase (e.g., User, Product)
 {{model_name}} - The snake_case version for URLs and IDs (e.g., user, product)
 {{modelName}} - The camelCase version for JavaScript variables (e.g., user, product)
 {{table_headers}} - Will be expanded to table header columns for each field
 {{table_columns}} - Will be expanded to table data columns for each field

TOKEN REPLACEMENT:
 - TemplateEngine.EvaluateTemplate() replaces all {{placeholder}} tokens
 - Table headers and columns are generated from model field definitions
 - JavaScript variable names use camelCase convention

jRDC2 INTEGRATION:
 - List page fetches data from API endpoint: GET /api/{{model_name}}
 - API handler uses jRDC2 to query database
 - JavaScript renders table dynamically from JSON response
 - CRUD operations (Create, Edit, Delete) call respective API endpoints

API ENDPOINTS:
 - GET    /api/{{model_name}}      - Fetch all records
 - GET    /api/{{model_name}}/:id  - Fetch single record
 - POST   /api/{{model_name}}      - Create new record
 - PUT    /api/{{model_name}}/:id  - Update record
 - DELETE /api/{{model_name}}/:id  - Delete record
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ModelName}} List</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="page-header">
            <h1>{{ModelName}} Management</h1>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="window.location.href='/web/{{model_name}}/new'">
                    <span class="icon">+</span> Create New {{ModelName}}
                </button>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="filter-section">
            <input type="text" id="searchInput" class="form-control" placeholder="Search {{ModelName}}..." onkeyup="filterTable()">
            <button class="btn btn-secondary" onclick="refreshData()">
                <span class="icon">â†»</span> Refresh
            </button>
        </div>

        <!-- Data Table -->
        <div class="table-container">
            <table class="data-table" id="{{model_name}}Table">
                <thead>
                    <tr>
                        <th>ID</th>
{{table_headers}}
                        <th>Created At</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="{{model_name}}TableBody">
                    <!-- Table rows will be populated by JavaScript -->
                    <tr>
                        <td colspan="100" class="text-center">Loading data...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-container">
            <button class="btn btn-secondary" onclick="previousPage()" id="btnPrevious">Previous</button>
            <span id="pageInfo">Page 1</span>
            <button class="btn btn-secondary" onclick="nextPage()" id="btnNext">Next</button>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h2>Confirm Delete</h2>
            <p>Are you sure you want to delete this {{ModelName}}?</p>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
                <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Include JavaScript -->
    <script src="/assets/js/common.js"></script>
    <script src="/assets/js/api.js"></script>
    <script>
        // Page state
        let currentPage = 1;
        let itemsPerPage = 10;
        let allData = [];
        let deleteItemId = null;

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        // Load {{ModelName}} data from API
        async function loadData() {
            try {
                const response = await API.get('{{model_name}}');
                allData = response;
                renderTable(allData);
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load data');
            }
        }

        // Render table with data
        function renderTable(data) {
            const tbody = document.getElementById('{{model_name}}TableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="100" class="text-center">No records found</td></tr>';
                return;
            }

            // Calculate pagination
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedData = data.slice(start, end);

            // Render each row
            paginatedData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.id || ''}</td>
{{table_columns}}
                    <td>${formatDate(item.created_at)}</td>
                    <td class="actions">
                        <button class="btn btn-sm btn-info" onclick="viewItem(${item.id})">View</button>
                        <button class="btn btn-sm btn-warning" onclick="editItem(${item.id})">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem(${item.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Update pagination info
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${Math.ceil(data.length / itemsPerPage)}`;
        }

        // Filter table based on search input
        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = allData.filter(item => {
                return JSON.stringify(item).toLowerCase().includes(searchTerm);
            });
            currentPage = 1;
            renderTable(filteredData);
        }

        // Pagination functions
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable(allData);
            }
        }

        function nextPage() {
            const maxPage = Math.ceil(allData.length / itemsPerPage);
            if (currentPage < maxPage) {
                currentPage++;
                renderTable(allData);
            }
        }

        // Refresh data
        function refreshData() {
            loadData();
        }

        // View item details
        function viewItem(id) {
            window.location.href = `/web/{{model_name}}/${id}`;
        }

        // Edit item
        function editItem(id) {
            window.location.href = `/web/{{model_name}}/${id}/edit`;
        }

        // Delete item - show confirmation modal
        function deleteItem(id) {
            deleteItemId = id;
            document.getElementById('deleteModal').style.display = 'block';
        }

        // Confirm delete
        async function confirmDelete() {
            try {
                await API.delete('{{model_name}}', deleteItemId);
                closeDeleteModal();
                loadData(); // Reload data
                showSuccess('{{ModelName}} deleted successfully');
            } catch (error) {
                console.error('Error deleting:', error);
                showError('Failed to delete {{ModelName}}');
            }
        }

        // Close delete modal
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            deleteItemId = null;
        }

        // Format date
        function formatDate(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        // Show success message
        function showSuccess(message) {
            alert(message); // Replace with better notification system
        }

        // Show error message
        function showError(message) {
            alert(message); // Replace with better notification system
        }
    </script>
</body>
</html>
